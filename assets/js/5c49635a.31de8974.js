"use strict";(self.webpackChunkfirplak_documentation=self.webpackChunkfirplak_documentation||[]).push([[1384],{3905:function(e,a,n){n.d(a,{Zo:function(){return u},kt:function(){return m}});var t=n(7294);function i(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function o(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function r(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?o(Object(n),!0).forEach((function(a){i(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function l(e,a){if(null==e)return{};var n,t,i=function(e,a){if(null==e)return{};var n,t,i={},o=Object.keys(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||(i[n]=e[n]);return i}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)n=o[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=t.createContext({}),c=function(e){var a=t.useContext(s),n=a;return e&&(n="function"==typeof e?e(a):r(r({},a),e)),n},u=function(e){var a=c(e.components);return t.createElement(s.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},p=t.forwardRef((function(e,a){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),m=i,k=p["".concat(s,".").concat(m)]||p[m]||d[m]||o;return n?t.createElement(k,r(r({ref:a},u),{},{components:n})):t.createElement(k,r({ref:a},u))}));function m(e,a){var n=arguments,i=a&&a.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=p;var l={};for(var s in a)hasOwnProperty.call(a,s)&&(l[s]=a[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var c=2;c<o;c++)r[c]=n[c];return t.createElement.apply(null,r)}return t.createElement.apply(null,n)}p.displayName="MDXCreateElement"},9781:function(e,a,n){n.r(a),n.d(a,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return u},default:function(){return p}});var t=n(7462),i=n(3366),o=(n(7294),n(3905)),r=["components"],l={},s="Como funciona el sistema de plantillas",c={unversionedId:"general/aplicacion-servicios/notification-template",id:"general/aplicacion-servicios/notification-template",title:"Como funciona el sistema de plantillas",description:"El sistema de plantillas para las notificaciones tiene un funcionamiento relativamente sencillo. Este permite mediante el uso de JMESPath, introducir atributos de un objeto que se hace accesible para la plantilla.",source:"@site/docs/general/aplicacion-servicios/notification-template.md",sourceDirName:"general/aplicacion-servicios",slug:"/general/aplicacion-servicios/notification-template",permalink:"/documentacion/docs/general/aplicacion-servicios/notification-template",editUrl:"https://github.com/firplak/documentacion/docs/general/aplicacion-servicios/notification-template.md",tags:[],version:"current",frontMatter:{},sidebar:"defaultSidebar",previous:{title:"Estructura de los datos de la aplicacion de servicios",permalink:"/documentacion/docs/general/aplicacion-servicios/database-structure"},next:{title:"Sincronizacion de datos entre la aplicacion de servicios de legado (Power Apps) y su nueva version (Supabase)",permalink:"/documentacion/docs/general/aplicacion-servicios/synchronization-system"}},u=[{value:"Plantillas",id:"plantillas",children:[{value:"Ejemplo de plantilla",id:"ejemplo-de-plantilla",children:[],level:3},{value:"Atributo users",id:"atributo-users",children:[{value:"Estructura de users",id:"estructura-de-users",children:[],level:4}],level:3},{value:"Atributo record",id:"atributo-record",children:[{value:"Estructura de record",id:"estructura-de-record",children:[],level:4}],level:3}],level:2},{value:"Atributo relations",id:"atributo-relations",children:[{value:"Ejemplo de relations",id:"ejemplo-de-relations",children:[],level:3}],level:2},{value:"Atributo related_users",id:"atributo-related_users",children:[{value:"Ejemplo 1 de related_users",id:"ejemplo-1-de-related_users",children:[],level:3},{value:"Ejemplo 2 (Ejemplo 1 de related_users continuacion)",id:"ejemplo-2-ejemplo-1-de-related_users-continuacion",children:[],level:3}],level:2},{value:"Filtros",id:"filtros",children:[{value:"De booleanos",id:"de-booleanos",children:[],level:3},{value:"De cadenas de texto",id:"de-cadenas-de-texto",children:[],level:3},{value:"De numeros",id:"de-numeros",children:[],level:3}],level:2}],d={toc:u};function p(e){var a=e.components,n=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,t.Z)({},d,n,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"como-funciona-el-sistema-de-plantillas"},"Como funciona el sistema de plantillas"),(0,o.kt)("p",null,"El sistema de plantillas para las notificaciones tiene un funcionamiento relativamente sencillo. Este permite mediante el uso de ",(0,o.kt)("a",{parentName:"p",href:"https://jmespath.org/"},"JMESPath"),", introducir atributos de un objeto que se hace accesible para la plantilla."),(0,o.kt)("h2",{id:"plantillas"},"Plantillas"),(0,o.kt)("h3",{id:"ejemplo-de-plantilla"},"Ejemplo de plantilla"),(0,o.kt)("p",null,"Un ejemplo de esto seria cuando se desea enviar una notificacion cuando se modifica un servicio y se desea informar sobre el consecutivo:"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Cuando se modifica la tabla ",(0,o.kt)("strong",{parentName:"p"},"Servicios")," usar la siguiente plantilla\n",(0,o.kt)("inlineCode",{parentName:"p"},"Se modifico el servicio con el consecutivo <% record.consecutivo %>"))),(0,o.kt)("p",null,"En este ejemplo se puede evidenciar el uso de los siguientes caracteres `",(0,o.kt)("inlineCode",{parentName:"p"},"<% ... %>"),", estos indican al sistema de plantillas que se desea cambiar el valor que hay dentro",(0,o.kt)("inlineCode",{parentName:"p"},"<% ESTE_VALOR %>"),", el cual debe ser un JSONPath procesable por ",(0,o.kt)("a",{parentName:"p",href:"https://jmespath.org/"},"JMESPath"),", este valor debe ser reemplazado por el atributo solicitado del objeto."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"El sistema de plantillas esta disponible solo desde las siguientes columnas de la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Notificaciones")),(0,o.kt)("pre",{parentName:"blockquote"},(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Notificaciones(recipients)\nNotificaciones(subject_template)\nNotificaciones(body_template)\n"))),(0,o.kt)("p",null,"La estructura del objeto es la siguiente:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"{\n    users: {\n        ...\n    },\n    record: {\n        ...\n    },\n    relations: [\n        ...\n    ],\n    related_user: [\n        ...\n    ],\n    additional_values: [\n        ...\n    ]\n}\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Notar la diferencia ente los atributos que son definidos con ",(0,o.kt)("inlineCode",{parentName:"p"},"{}")," y ",(0,o.kt)("inlineCode",{parentName:"p"},"[]"))),(0,o.kt)("h3",{id:"atributo-users"},"Atributo users"),(0,o.kt)("p",null,"El atributo users contiene toda llave foranea que referencie a la tabla usuarios de la tabla de la cual se haya originado la solicitud de notificacion, para cada llave foranea se le asignara como valor el respectivo usuario referenciado, entonces internamente cada una de estas llaves foraneas tendra la siguiente estructura"),(0,o.kt)("blockquote",null,(0,o.kt)("pre",{parentName:"blockquote"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n  id: 63,\n  created_at: "2023-10-03T14:08:26.390415+00:00",\n  user_id: "1f009f87-5c03-4b71-9fbf-9531006addf1",\n  display_name: "Javier Uribe",\n  rol: "tecnico",\n  nombres: "Javier",\n  apellidos: "Uribe",\n  url_foto: null,\n  correo: "consultor1@firplak.com",\n  cedula: null\n}```\n\n_Linea de la tabla `Usuarios`_\n'))),(0,o.kt)("h4",{id:"estructura-de-users"},"Estructura de users"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'{\n    users: {\n        "tecnico_id": {\n            ...\n        },\n        "usuario_id": {\n            ...\n        },\n        "llave_foranea_que_referencie_a_la_tabla_usuarios": {\n            ...\n        }\n    },\n    ...\n}\n')),(0,o.kt)("h3",{id:"atributo-record"},"Atributo record"),(0,o.kt)("p",null,"Contiene todos las columnas de la linea de la tabla que origino la solicitud de notificacion"),(0,o.kt)("h4",{id:"estructura-de-record"},"Estructura de record"),(0,o.kt)("p",null,"Si la tabla que origino la solicitud de notificacion fue ",(0,o.kt)("strong",{parentName:"p"},"Servicios")," por ejemplo"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'{\n    record: {\n        id: 76,\n        created_at: "2023-09-21T21:33:34.373081+00:00",\n        consecutivo: "JhoDavMant6299",\n        numero_de_pedido: "PRUEBA912",\n        comercial_id: 1,\n        consumidor_id: 132,\n        estado: true,\n        ubicacion_id: 37,\n        consecutivo_sap: null,\n        fecha_cierre: null,\n        coordinador_id: 30,\n        pedido_digitado: null,\n        orden_de_venta: "PRUEBA",\n        actividad_mac: null,\n        decision_cliente: null,\n        sharepoint_uid: "a46f79fe-831b-4e15-bc54-038907099bf0",\n        tipo_de_servicio: "mantenimiento",\n        canal_de_venta: "canal_ditribuidor",\n        cerrado_por: null\n    },\n    ...\n}\n')),(0,o.kt)("h2",{id:"atributo-relations"},"Atributo relations"),(0,o.kt)("p",null,"Este atributo contiene toda relacion que se haga desde la tabla que origino la solicitud de notificacion hacia otra tabla"),(0,o.kt)("h3",{id:"ejemplo-de-relations"},"Ejemplo de relations"),(0,o.kt)("p",null,"Si la tabla que origino la solicitud de notificacion fue ",(0,o.kt)("strong",{parentName:"p"},"Servicios")," y servicios cuenta con las siguientes llaves foraneas."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Usuarios(comercial_id) \nUsuarios(coordinador_id)\nConsumidores(consumidor_id)\nUbicaciones(ubicacion_id)\n")),(0,o.kt)("p",null,"Estas se transforman de la siguiente manera"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Usuarios(comercial_id)      se convierte en `Usuarios_comercial_id\nUsuarios(coordinador_id)    se convierte en `Usuarios_coordinador_id\nConsumidores(consumidor_id) se convierte en `Consumidores_consumidor_id\nUbicaciones(ubicacion_id)   se convierte en `Ubicaciones_ubicacion_id\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Tabla(llave_foranea)        se convierte en `Tabla_llave_foranea\n")),(0,o.kt)("p",null,"Y terminan en el atributo relations de la siguiente manera"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"{\n   relations: {\n       'Usuarios_comercial_id': { ... },\n       'Usuarios_coordinador_id': { ... },\n       'Consumidores_consumidor_id': { ... };\n       'Ubicaciones_ubicacion_id': { ... }\n   }, \n   ...\n}\n")),(0,o.kt)("p",null," Donde todos las llaves tienen los respectivos elementos de la base de datos"),(0,o.kt)("h2",{id:"atributo-related_users"},"Atributo related_users"),(0,o.kt)("p",null,"El funcionamiento es muy similar a el anterior solo que cuando ya tenemos las relaciones definidas, lo que hacemos es extraer de estas relaciones todos los usuarios relacionados"),(0,o.kt)("h3",{id:"ejemplo-1-de-related_users"},"Ejemplo 1 de related_users"),(0,o.kt)("p",null,"Una solitidud de notificacion originada por la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Visitas")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Visitas -> Servicio -> Usuarios(coordinador_id)\n")),(0,o.kt)("p",null,"En related_users se encuentran todos los ",(0,o.kt)("inlineCode",{parentName:"p"},"X -> Y -> Usuarios(*)")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Importante notar que solo nos interesan las relaciones que tengan como destino la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Usuarios"))),(0,o.kt)("p",null,"La manera en la cual se estructuran los nombres de related users es:"),(0,o.kt)("h3",{id:"ejemplo-2-ejemplo-1-de-related_users-continuacion"},"Ejemplo 2 (Ejemplo 1 de related_users continuacion)"),(0,o.kt)("p",null,"Vamos a seguir con el ejemplo con la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Visitas")),(0,o.kt)("p",null,"Las relaciones de la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Visitas")," son las siguientes:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Servicios(servicio_id)\nUsuarios(tecnico_id) \nUsuarios(modified_by)\n")),(0,o.kt)("p",null,"Vamos a filtrar todas las relaciones con la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Usuarios")," porque ya contamos con estos datos en el ",(0,o.kt)("strong",{parentName:"p"},"Atributo user"),". Quedamos con las siguientes relaciones"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Servicios(servicio_id)\n")),(0,o.kt)("p",null,"Ahora vamos a identificar las relaciones con la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Usuarios")," que hay en cada una de estas tablas, como vimos anteriormente las relaciones que tiene la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Servicios")," con la tabla ",(0,o.kt)("inlineCode",{parentName:"p"},"Usuarios")," son las siguientes"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Usuarios(comercial_id)\nUsuarios(coordinador_id)\n")),(0,o.kt)("p",null,"Entonces ahora contamos con las siguientes relaciones"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Visitas -> Servicios(servicio_id) -> Usuarios(comercial_id)\nVisitas -> Servicios(servicio_id) -> Usuarios(coordinador_id)\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Conviene abstraerlo como se indico anteriormente ",(0,o.kt)("inlineCode",{parentName:"p"},"X -> Y -> Usuarios(*)"))),(0,o.kt)("p",null,"Entonces related_users lo que contiene es esta ultima parte, todas las relaciones con la tabla usuarios que estan presentes en las relaciones con la tabla que origino la solicitud de notificacion, el ",(0,o.kt)("inlineCode",{parentName:"p"},"Usuarios(*)")," de la abstraccion."),(0,o.kt)("p",null,"Contando con las relaciones mencionadas anteriormente en la forma ",(0,o.kt)("inlineCode",{parentName:"p"},"X -> Y -> Usuarios(*)")," facilmente podemos ver que hay informacion irrelevante, ",(0,o.kt)("inlineCode",{parentName:"p"},"X"),", entonces reducimos a ",(0,o.kt)("inlineCode",{parentName:"p"},"Y -> Usuarios(*)"),", y para facilitar el manejo de estas relaciones tambien se ignora cual es la llave foranea que hay en ",(0,o.kt)("inlineCode",{parentName:"p"},"X")," de ",(0,o.kt)("inlineCode",{parentName:"p"},"Y")," (por ejemplo, ignoramos que la llave foranea que hay en ",(0,o.kt)("inlineCode",{parentName:"p"},"Visitas"),"[",(0,o.kt)("inlineCode",{parentName:"p"},"X"),"]"," de  ",(0,o.kt)("inlineCode",{parentName:"p"},"Servicios"),"[",(0,o.kt)("inlineCode",{parentName:"p"},"Y"),"]"," que en este caso seria ",(0,o.kt)("inlineCode",{parentName:"p"},"servicio_id"),") para solo quedar con los siguientes datos"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Servicios -> Usuarios(comercial_id)\nServicios -> Usuarios(coordinador_id)\n")),(0,o.kt)("p",null,"Teniendo estas relaciones las transformamos de la siguiente manera"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-hs"},"Servicios -> Usuarios(comercial_id)` se convierte en Servicios_comercial_id\nServicios -> Usuarios(coordinador_id)` se convierte en Servicios_coordinador_id\n")),(0,o.kt)("p",null,"Y finalmente nuestro atributo related_users termina con la siguiente estructura"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"{\n   related_users:{\n       'Servicios_comercial_id': {\n           ...\n       }\n       'Servicios_coordinador_id': {\n           ...\n       }\n   },\n   ...\n}\n")),(0,o.kt)("h2",{id:"filtros"},"Filtros"),(0,o.kt)("p",null,"Todos los filtros se introducen en la columna ",(0,o.kt)("inlineCode",{parentName:"p"},"Notificaciones(conditions)")," en formato JSON con la estructura indicada segun el tipo de datos que se quiera filtrar"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Estos filtros determinan si una notificacion debe ser enviada segun el estado actual de la fila de la tabla que origino la solicitud de notificacion")),(0,o.kt)("h3",{id:"de-booleanos"},"De booleanos"),(0,o.kt)("p",null,"Un filtro de valores booleanos debe tener la siguiente estructura"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'{\n    "NOMBRE_DE_LA_COLUMNA": {\n        "value": boolean\n    }\n}\n')),(0,o.kt)("h3",{id:"de-cadenas-de-texto"},"De cadenas de texto"),(0,o.kt)("p",null,"Un filtro de valores string debe tener la siguiente estructura"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'{\n    "NOMBRE_DE_LA_COLUMNA": {\n        "blob": "blob-like string para documentacion de la sintaxis ver https://www.npmjs.com/package/micromatch"\n    }\n}\n')),(0,o.kt)("h3",{id:"de-numeros"},"De numeros"),(0,o.kt)("p",null,"Un filtro de valores numericos debe tener la siguiente estructura"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},'/*\neq: igual a\ngt: mayor que\ngte: mayor o igual que\nlt: menor que\nlte: menor o igual que\nneq: diferente de\n*/\n{\n    "NOMBRE_DE_LA_COLUMNA": {\n        eq?: number,\n        gt?: number,\n        gte?: number,\n        lt?: number,\n        lte?: number,\n        neq?: number\n    }\n}\n')))}p.isMDXComponent=!0}}]);